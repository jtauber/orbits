<!DOCTYPE html>
<html>
  <head>
    <title>Kepler's Second Law â€” Orbits Tutorial</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav>
      <a href="./">Orbits Tutorial</a> &mdash;
      <a href="010.html">10</a> |
      <a href="015.html">15</a> |
      <a href="020.html" class="active">20</a> |
      <a href="040.html">40</a> |
      <a href="050.html">50</a>
      <a href="https://twitter.com/jtauber" class="twitter">@jtauber</a>
    </nav>
    <main>
      <h2>Kepler's Second Law</h2>
      <p>
        Planets move faster when they are closer to the Sun.
        One of Kepler's great observations was that the area swept in a given
        time by the line between the Sun and planet stays constant.
      </p>
      <div id="drawing"></div>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.4/svg.min.js">
    </script>
    <script>

      var mx = 800;
      var my = 800;

      var draw = SVG('drawing').size(mx, my);

      var cx = mx / 2;
      var cy = my / 2;

      var a = 300;
      var b = 250;

      var ecc = Math.sqrt(1 - Math.pow(b / a, 2));
      var slr = Math.pow(b, 2) / a;

      var path = draw.path().fill("#303027");

      var focus1 = draw.circle(20).fill("rgba(211, 211, 211, 1.0)");
      var orbit = draw.ellipse().fill("none").stroke("rgba(211, 211, 211, 1.0)").center(cx, cy);

      var planet = draw.circle(10).fill("rgba(211, 211, 211, 1.0)");

      var fx = cx - Math.sqrt(a*a - b*b);
      var fy = cy;

      focus1.center(fx, fy);
      orbit.size(a * 2, b * 2);

      var line1 = draw.line(0, 0, fx, fy).stroke({ width: 1, color: "rgba(211, 211, 211, 1.0)"});
      var line2 = draw.line(0, 0, fx, fy).stroke({ width: 1, color: "rgba(211, 211, 211, 1.0)"});

      function position(t) {
        // mean anomaly
        var M = 2 * Math.PI * t;

        // calculate eccentric anomaly using Newton-Rhapson
        var E = M;
        var next = 0;
        var count = 0;
        while (count++ < 10) {
          next = E + (M - (E - ecc * Math.sin(E)))/(1 - ecc * Math.cos(E));
          if (Math.abs(next - E) < 1E-6) {
            break;
          }
          E = next;
        }

        // calculate total anomaly
        var theta = 2 * Math.atan2(Math.sqrt(1 - ecc) * Math.cos(E / 2), Math.sqrt(1 + ecc) * Math.sin(E / 2));

        // calculate distance from focus
        var r = a * (1 - ecc * Math.cos(E));

        return [r, theta];
      }

      function callback(ms) {
        var t = (ms / 5000) % 1;
        [r, theta] = position(t);
        [r2, theta2] = position(t - 0.05);

        var x1 = fx + r * Math.cos(theta);
        var y1 = fy + r * Math.sin(theta);
        var x2 = fx + r2 * Math.cos(theta2);
        var y2 = fy + r2 * Math.sin(theta2);

        if (!isNaN(x1)) {
          planet.center(x1, y1);
          line1.plot(x1, y1, fx, fy);
          line2.plot(x2, y2, fx, fy);
          path.plot(`M ${x1} ${y1} A ${a} ${b} 0 0 1 ${x2} ${y2} L ${fx} ${fy}`);
        }
        requestAnimationFrame(callback);
      }

      callback();
    </script>
  </body>
</html>
